<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Dependency Monkey Design Document &#8212; Thoth Adviser 0.5.0 documentation</title>
    <link rel="stylesheet" href="_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/sidebar.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Integrating with Thoth" href="integration.html" />
    <link rel="prev" title="Dependency Graph" href="dependency_graph.html" />

    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <link rel="shortcut icon" type="image/png" href="_static/favicon.png" />
    <meta name="viewport" content="width=device-width,initial-scale=0.8">
    
    

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-123174547-2']);
  _gaq.push(['_trackPageview']);
</script>

  </head><body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="responsive-menu"><a href="#sidebar-anchor" title="Navigation">&#9776;</a></li>
        <li><a href="index.html">Thoth Adviser 0.5.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="dependency-monkey-design-document">
<span id="dependency-monkey"></span><h1>Dependency Monkey Design Document<a class="headerlink" href="#dependency-monkey-design-document" title="Permalink to this headline">¶</a></h1>
<p>This document discusses Dependency Monkey design in project Thoth. Dependency
Monkey is a tool which aims to automatically verify software stacks and
aggregate relevant observations into Thoth’s knowledge database.</p>
<div class="section" id="dependency-monkey-use-cases">
<h2>Dependency Monkey use cases<a class="headerlink" href="#dependency-monkey-use-cases" title="Permalink to this headline">¶</a></h2>
<p>Dependency Monkey was designed to automate the evaluation of certain aspects of a
software stack, such as code quality or performance. Two main aspects will be
derived from software stacks as observations. Observations are currently
consumed by Thoth for its recommendations/advices:</p>
<ol class="arabic simple">
<li><p>Does the given software build on a given Operating System on the targeted hardware (if any hardware requirements such as specific CPU are provided for builds)?</p></li>
<li><p>What are runtime characteristics of the given software stack on targeted hardware (if requested a specific one, any hardware available is used to test the software stack). An example of runtime characteristics could be performance indicators or indicators such as accuracy in case of math libraries.</p></li>
</ol>
</div>
<div class="section" id="dependency-monkey-architecture-design-and-overview">
<h2>Dependency Monkey architecture design and overview<a class="headerlink" href="#dependency-monkey-architecture-design-and-overview" title="Permalink to this headline">¶</a></h2>
<p>Dependency Monkey is made out of multiple parts used in the project Thoth:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/thoth-station/management-api/">Management API</a> (optional)</p></li>
<li><p>Dependency Monkey job (see <a class="reference external" href="https://github.com/thoth-station/adviser">this repo sources</a>)</p></li>
<li><p><a class="reference external" href="https://github.com/thoth-station/amun-api">Amun API</a></p></li>
<li><p>Inspection builds and inspection jobs (generated by Amun API)</p></li>
</ul>
</div>
<div class="section" id="example-use-of-dependency-monkey">
<h2>Example Use of Dependency Monkey<a class="headerlink" href="#example-use-of-dependency-monkey" title="Permalink to this headline">¶</a></h2>
<p>To illustrate Dependency Monkey use, let’s create a fictional use case. A first
interaction point can be <code class="docutils literal notranslate"><span class="pre">/dependency-monkey/python</span></code> endpoint exposed on Thoth’s
Management API service (there is currently supported only Python ecosystem).
This endpoint accepts input from a user which is in the form of a software stack
that should be validated. The software stack input is compatible with <code class="docutils literal notranslate"><span class="pre">Pipfile</span></code>
as produced by <a class="reference external" href="https://pipenv.readthedocs.io">Pipenv</a> that can assign
different package indexes to packages so dependency monkey can verify Python
packages across different Python package indexes.</p>
<p>Besides software stack, the mentioned dependency-monkey endpoint accepts a base image
that should be used for software stack validation and verification. Currently,
supported distributions span across those using <code class="docutils literal notranslate"><span class="pre">dnf</span></code>, <code class="docutils literal notranslate"><span class="pre">yum</span></code> and <code class="docutils literal notranslate"><span class="pre">apt</span></code> for native
packages. There can be optionally passed a list of native packages that should
be installed into the given base image on build time (for example <code class="docutils literal notranslate"><span class="pre">Pipenv</span></code> for
testing <code class="docutils literal notranslate"><span class="pre">Pipenv</span></code> provided in Fedora as an rpm). Optionally a URL or a script can be
passed  and will be used to validate the given software stack (scripts output a
JSON - see <a class="reference external" href="https://github.com/fridex/tf-benchmark-mock/blob/master/benchmark.py">this
example</a>).
See OpenAPI specification of <a class="reference external" href="https://github.com/thoth-station/management-api">Management
API</a> to see all the possible
options.</p>
<p>Once the dependency-monkey endpoint is triggered with the requested input, a
“Dependency Monkey” job is created  in one of the <a class="reference external" href="https://github.com/thoth-station/core#architecture-overview">Thoth’s
namespaces</a>
reserved for Dependency Monkey runs (pre-allocated pool of resources).</p>
<p>The Dependency Monkey job creates an in-memory structure that can generate all the
possible software stacks given the software stack specification in <code class="docutils literal notranslate"><span class="pre">Pipfile</span></code> (additional configuration might be applied, see <a class="reference internal" href="pipeline.html#pipeline"><span class="std std-ref">Stack generation pipeline</span></a> for more info). The
resolution algorithm utilizes core <code class="docutils literal notranslate"><span class="pre">pip</span></code> resolution mechanism for Python package versions to guarantee the
result to be fully compatible with Python’s pip. The actual dependency
resolution is, however, not done by <code class="docutils literal notranslate"><span class="pre">pip</span></code> or <code class="docutils literal notranslate"><span class="pre">Pipenv</span></code>. An off-line dependency
resolution algorithm was designed in support with pre-computed data available
in the graph database (see <a class="reference internal" href="dependency_graph.html#dependency-graph"><span class="std std-ref">Dependency Graph</span></a>). This makes resolution much faster in comparison to
native pip or <code class="docutils literal notranslate"><span class="pre">Pipenv</span></code> resolving (note there can be thousands or even millions of
possible software stack combinations).</p>
<p>The in-memory structure is capable of generating fully pinned down software
stacks as produced by pip or <code class="docutils literal notranslate"><span class="pre">Pipenv</span></code> in real world. These software stacks are
subsequently sent to Amun API service for inspection (along with context given
on the dependency-monkey management API endpoint such as base container image,
native packages, …).</p>
<p>Amun is a service that is capable of building software stacks considering the
base container image and native packages that are requested to be installed.
This procedure is done in the build inspection jobs triggered by Amun API in
inspection namespace with resources dedicated for inspection runs. OpenShift
builds and image streams were reused for building resulting container images.</p>
<p>If a user supplies a test script, an inspection job is created. The job’s goal
is to verify the given software stack. The very first step done by the
inspection job is gathering hardware information about runtime hardware present (and other node-specific characteristics, such as kernel version).
The inspection job after that executes user provided script (e.g. a Python
script) in the given environment and gathers all the relevant information in a
form of a JSON object (e.g. standard error, standard output, script’s status
code) - these information are called inspection job reports.</p>
<p>These reports are gathered by a job triggered by an operator and placed onto
Ceph as JSON documents. Besides that, results are gathered, parsed and
observations are feeded into the graph database where these observations are
used by Thoth’s recommendation engine to recommend high quality software stacks
based on gathered observations.  If a user wants to perform an inspection on a
pinned down software stack without running the Dependency Monkey job to
generate software stacks, the thoth-adviser  CLI can be utilized.
<a class="reference external" href="https://github.com/thoth-station/adviser">Thoth-adviser</a> provides submit-amun
subcommand to trigger Amun API to run the inspection job and build (or use
REST exposed by OpenAPI UI to trigger inspection run directly from a web browser).</p>
<a class="reference external image-reference" href="_static/dm.png"><img alt="Dependency Monkey" src="_images/dm.png" /></a>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
    <a id="sidebar-anchor"></a>
    

  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Dependency Monkey Design Document</a><ul>
<li><a class="reference internal" href="#dependency-monkey-use-cases">Dependency Monkey use cases</a></li>
<li><a class="reference internal" href="#dependency-monkey-architecture-design-and-overview">Dependency Monkey architecture design and overview</a></li>
<li><a class="reference internal" href="#example-use-of-dependency-monkey">Example Use of Dependency Monkey</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="dependency_graph.html"
                        title="previous chapter">Dependency Graph</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="integration.html"
                        title="next chapter">Integrating with Thoth</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/dependency_monkey.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="integration.html" title="Integrating with Thoth"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="dependency_graph.html" title="Dependency Graph"
             accesskey="P">previous</a> |</li>
      </ul>
    </div>


    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Thoth team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
    </div>
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>

  </body>
</html>